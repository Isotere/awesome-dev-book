---
tags:
  - GoLang/SoftwareDesign/Patterns/Throttle
---

Ограничивает частоту вызовов функции некоторым предельным числом вызовов в единицу времени.

Устранение резких всплесков активности, способных привести к насыщению системы необоснованным кол-вом дорогостоящих запросов, которые могут привести к замедлению или отказу. 

## Компоненты

- Effector - функция, частоту вызовов которой нужно ограничить
- Throttle - функция, принимающая Effector и возвращающее замыкание с той же сигнатурой

## Реализация

Чаще всего используется алгоритм *корзины жетонов* (token bucket), по аналогии с корзиной, в которой можно хранить не больше некоторого числа жетонов. Когда функция вызывается, из корзины извлекается один жетон, при этом корзина пополняется новыми жетонами с некоторой фиксированной скоростью. 

Как поступать, когда нет жетонов: 
- вернуть ошибку
- вернуть ответ последнего успешного вызова функции (когда функция возвращает какое-то постоянное значение в рамках временного интервала)
- поставить запрос в очередь и выполнить его когда появится жетон (можно исчерпать все лимиты)

## Пример кода

[ссылка на репу](https://github.com/Isotere/awesome-dev-book/blob/master/code/go_lang/software_tpls/throttle/main.go)

[ссылка rate-limiter-1](https://github.com/Isotere/awesome-dev-book/blob/master/code/go_lang/use_cases/rate_limiter/main.go)

[ссылка rate-limiter-2](https://github.com/Isotere/awesome-dev-book/tree/master/code/go_lang/use_cases/rate_limiter2)

